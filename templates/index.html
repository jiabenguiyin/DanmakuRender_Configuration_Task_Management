<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç›´æ’­é…ç½®ä»»åŠ¡ç®¡ç†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        #tagsContainer .badge {
            background-color: #4a5568 !important; /* æ·±ç°è‰²èƒŒæ™¯ */
            color: white !important;
            margin-right: 5px;
        }
        #tagsContainer .badge .text-danger {
            color: #fed7d7 !important; /* æµ…çº¢è‰²åˆ é™¤æŒ‰é’® */
            cursor: pointer;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“‹ é…ç½®ä»»åŠ¡ç®¡ç†ç•Œé¢</h2>

        <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
        <form method="POST" action="/add" class="row g-3 mt-4 mb-4">
            <div class="col-md-3">
                <select name="filename" class="form-control">
                    {% for file in yml_files %}
                        <option value="{{ file }}">{{ file }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <input name="start" type="date" class="form-control" required>
            </div>
            <div class="col-md-3">
                <input name="end" type="date" class="form-control" required>
            </div>
            <div class="col-md-3">
                <div class="row g-2">
                    <div class="col-6">
                        <button class="btn btn-primary w-100">â• æ·»åŠ ä»»åŠ¡</button>
                    </div>
                    <div class="col-6">
                        <button type="button" class="btn btn-secondary w-100" 
                                data-bs-toggle="modal" data-bs-target="#templateModal">
                            â• æ–°å»ºæ¨¡æ¿
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <table class="table table-bordered table-hover">
            <thead class="table-light">
                <tr>
                    <th>é…ç½®æ–‡ä»¶</th>
                    <th>å¼€å§‹æ—¥æœŸ</th>
                    <th>ç»“æŸæ—¥æœŸ</th>
                    <th>å½“å‰çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for task in schedule %}
                <tr>
                    <td>{{ task.filename }}</td>
                    <td>{{ task.start }}</td>
                    <td>{{ task.end }}</td>
                    <td>
                        {% if task.status == 'å¯ç”¨ä¸­' %}
                            <span class="text-success">{{ task.status }}</span>
                        {% else %}
                            <span class="text-danger">{{ task.status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal"
                                data-filename="{{ task.filename }}" data-start="{{ task.start }}" data-end="{{ task.end }}">
                            ç¼–è¾‘
                        </button>
                        <a class="btn btn-sm btn-info" href="/toggle_task/{{ task.filename }}">
                            {% if task.status == 'å¯ç”¨ä¸­' %}
                                ç¦ç”¨
                            {% else %}
                                å¯ç”¨
                            {% endif %}
                        </a>
                        <a class="btn btn-sm btn-danger" href="/delete/{{ task.filename }}">åˆ é™¤</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Modal æ–°å»ºç›´æ’­é—´æ¨¡æ¿ -->
    <div class="modal fade" id="templateModal" tabindex="-1" aria-labelledby="templateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templateModalLabel">æ–°å»ºç›´æ’­é—´æ¨¡æ¿</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="POST" action="/create_template">
                        <div class="mb-3">
                            <label for="taskname" class="form-label">è¯·è¾“å…¥ä¸»æ’­å</label>
                            <input type="text" name="taskname" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="url" class="form-label">è¯·è¾“å…¥ç›´æ’­é—´é“¾æ¥</label>
                            <input type="text" name="url" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="tag" class="form-label">æ ‡ç­¾</label>
                            <input type="text" name="tag" class="form-control tag-input" id="tagInput" placeholder="è¯·è¾“å…¥æ ‡ç­¾åå›è½¦">
                            <div id="tagsContainer" class="mt-2">
                                <span class="badge bg-light me-1">ç›´æ’­å½•åƒ</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="is_repost" class="form-label">æ˜¯å¦ä¸ºè½¬è½½</label>
                            <input type="checkbox" name="is_repost">
                        </div>
                        <button type="submit" class="btn btn-primary">ä¿å­˜æ¨¡æ¿</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ ‡ç­¾æ·»åŠ å’Œåˆ é™¤åŠŸèƒ½
        const tagInput = document.getElementById('tagInput');
        const tagsContainer = document.getElementById('tagsContainer');

        tagInput.addEventListener('keydown', function(event) {
            // é˜»æ­¢å›è½¦æ—¶è¡¨å•æäº¤
            if (event.key === 'Enter' && tagInput.value.trim() !== '') {
                event.preventDefault();  // é˜»æ­¢è¡¨å•æäº¤
                const tag = tagInput.value.trim();
                addTag(tag);
                tagInput.value = '';
            }
        });

        function addTag(tag) {
            const tagDiv = document.createElement('div');
            tagDiv.classList.add('badge', 'bg-light', 'me-1');
            tagDiv.innerHTML = `${tag} <span class="text-danger" onclick="removeTag(this)">Ã—</span>`;
            tagsContainer.appendChild(tagDiv);
        }

        function removeTag(tagElement) {
            tagsContainer.removeChild(tagElement.parentElement);
        }
    </script>
</body>
</html>
